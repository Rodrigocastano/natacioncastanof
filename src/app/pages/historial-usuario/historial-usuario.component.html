<!-- Tabla adaptativa -->
<div class="overflow-x-auto w-full" *ngIf="!loading">
  <p-table
    [value]="historial"
    [globalFilterFields]="['nombre', 'apellido', 'cedula', 'grupo', 'fecha_inicio', 'fecha_fin']"
    [rowHover]="true"
    dataKey="id"
    [paginator]="true"
    [rows]="6"
    [rowsPerPageOptions]="[6, 12, 18]"
    responsiveLayout="scroll"
    class="p-datatable-sm"
    currentPageReportTemplate="Mostrando del {first} al {last} de {totalRecords} registros"
    [showCurrentPageReport]="true"
    #dt
  >

    <!-- Título + Filtro global -->
    <ng-template #caption>
      <div class="flex items-center justify-between flex-wrap gap-2">
        <h5 class="m-0 text-base md:text-lg font-semibold">Historial de Usuarios</h5>
        <div class="flex items-center gap-2">
          <p-iconfield>
            <p-inputicon styleClass="pi pi-search" />
            <input
              pInputText
              type="text"
              placeholder="Buscar..."
              [(ngModel)]="filtro"
            [(ngModel)]="filtro"
            (input)="dt.filterGlobal(filtro, 'contains')"
            />
          </p-iconfield>
        </div>
      </div>
    </ng-template>

    <!-- Encabezados -->
    <ng-template #header>
      <tr>
        <th pSortableColumn="nombre" style="min-width: 10rem; text-align: left;">Usuario</th>
        <th pSortableColumn="cedula" style="min-width: 8rem; text-align: left;">Cédula</th>
        <th pSortableColumn="grupo" style="min-width: 8rem; text-align: left;">Grupo</th>
        <th pSortableColumn="fecha_inicio" style="min-width: 9rem; text-align: left;">Inicio</th>
        <th pSortableColumn="fecha_fin" style="min-width: 9rem; text-align: left;">Fin</th>
        <th pSortableColumn="estado_funcional" style="min-width: 7rem; text-align: left;">Estado</th>
        <th style="min-width: 8rem; text-align: left;">Acciones</th>
      </tr>
    </ng-template>

    <!-- Cuerpo -->
    <ng-template #body let-registro>
      <tr>
        <td>
          <div class="font-medium">{{ getNombreCompleto(registro) }}</div>
        </td>
        <td class="text-center">{{ registro.cedula }}</td>
        <td class="text-center">{{ registro.grupo }}</td>
        <td class="text-center">{{ registro.fecha_inicio | date: 'dd/MM/yyyy' }}</td>
        <td class="text-center">
          {{ registro.fecha_fin ? (registro.fecha_fin | date: 'dd/MM/yyyy') : 'Activo' }}

             <td>
                    <span [class]="'status-badge status-' + (registro.estado_funcional === 1 ? 'activo' : 'inactivo')">
                        {{ getEstadoFuncional(registro.estado_funcional) }}
                    </span>
                </td>

        <td class="text-center">
          <p-button icon="pi pi-eye" [rounded]="true" [outlined]="true" tooltip="Ver detalles" class="mr-2" />
        <!--   <p-button icon="pi pi-history" [rounded]="true" [outlined]="true" severity="info" tooltip="Ver historial" /> -->
        </td>
      </tr>
    </ng-template>

  </p-table>
</div>

<div *ngIf="loading" class="flex justify-center items-center h-[300px]">
  <p-progressSpinner [style]="{ width: '50px', height: '50px' }" styleClass="p-text-primary" />
</div>
